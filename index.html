<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reze's Biology Class</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');

        :root {
            --bg-color: #000000;
            --chat-bg: #0a0a0a;
            --accent-color: #bb86fc; /* Reze Purple */
            --danger-color: #ff4040; /* Blood Red */
            --bubble-bg: #1f1f1f;
            --user-bubble-bg: #6a1b9a;
            --text-main: #e0e0e0;
            --option-bg: #2d2d2d;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .phone-container {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            background-color: var(--chat-bg);
            box-shadow: 0 0 40px rgba(187, 134, 252, 0.15);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* 헤더 */
        .header {
            padding: 15px 20px;
            background-color: rgba(20, 20, 20, 0.95);
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .profile-pic-small {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid var(--accent-color);
        }

        .header-info h2 {
            font-size: 1rem;
            margin: 0;
            font-weight: 700;
            color: #fff;
        }

        .header-info span {
            font-size: 0.75rem;
            color: var(--accent-color);
            opacity: 0.9;
            letter-spacing: 0.5px;
        }

        /* 채팅 영역 */
        .chat-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scroll-behavior: smooth;
            padding-bottom: 20px;
        }
        .chat-area::-webkit-scrollbar { width: 4px; }
        .chat-area::-webkit-scrollbar-thumb { background: #333; }

        /* 메시지 스타일 */
        .message {
            display: flex;
            align-items: flex-end;
            max-width: 85%;
            animation: slideIn 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.reze { align-self: flex-start; }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }

        .bubble {
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .reze .bubble {
            background-color: var(--bubble-bg);
            border-bottom-left-radius: 4px;
            margin-left: 8px;
            color: #ddd;
            border-left: 2px solid var(--accent-color);
        }

        .user .bubble {
            background: linear-gradient(135deg, #7b1fa2, #4a148c);
            border-bottom-right-radius: 4px;
            margin-right: 8px;
            color: white;
        }

        .profile-pic-chat {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            margin-bottom: 5px;
            border: 1px solid #333;
        }

        /* 타이핑 인디케이터 */
        .typing-indicator {
            display: none;
            padding: 12px;
            background: var(--bubble-bg);
            border-radius: 18px;
            margin-left: 50px;
            width: fit-content;
            margin-bottom: 10px;
            border-bottom-left-radius: 4px;
        }
        .dot {
            height: 6px;
            width: 6px;
            background-color: #888;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: blink 1.4s infinite both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes blink { 0%, 80%, 100% { opacity: 0; } 40% { opacity: 1; } }

        /* 문제 카드 */
        .question-card {
            background: #161616;
            border-radius: 12px;
            padding: 15px;
            margin-top: 4px;
            border: 1px solid #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .question-tag {
            font-size: 0.7rem;
            color: var(--danger-color);
            font-weight: bold;
            margin-bottom: 6px;
            display: block;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 0.95rem;
            font-weight: 500;
            color: #fff;
            line-height: 1.5;
        }

        /* 4지선다 및 선택지 */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
            width: 100%;
            padding-left: 45px;
            padding-right: 20px;
        }

        .option-btn {
            background-color: var(--option-bg);
            color: #ccc;
            border: 1px solid #444;
            padding: 12px;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.2s;
        }

        .option-btn:hover {
            background-color: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
        }

        /* 입력창 */
        .input-area {
            padding: 12px 15px;
            background-color: #0f0f0f;
            border-top: 1px solid #222;
        }

        .input-wrapper {
            background-color: #252525;
            border-radius: 25px;
            padding: 4px 15px;
            display: flex;
            align-items: center;
            border: 1px solid #333;
        }

        input[type="text"] {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            padding: 10px;
            font-size: 0.95rem;
            outline: none;
        }

        button.send-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            font-weight: bold;
            cursor: pointer;
            padding: 6px 10px;
            font-size: 0.9rem;
        }
        
        button:disabled { color: #444; cursor: default; }

        /* 시작 화면 */
        .start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.94);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .start-img {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(187, 134, 252, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(187, 134, 252, 0); }
            100% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0); }
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="phone-container">
        <!-- 헤더 -->
        <div class="header">
            <img src="images-2.jpeg" alt="Reze" class="profile-pic-small">
            <div class="header-info">
                <h2>Reze</h2>
                <span>Active now</span>
            </div>
        </div>

        <!-- 채팅방 -->
        <div class="chat-area" id="chat-box"></div>
        
        <!-- 타이핑 효과 -->
        <div class="typing-indicator" id="typing">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>

        <!-- 입력창 -->
        <div class="input-area">
            <div class="input-wrapper">
                <input type="text" id="answer-input" placeholder="메시지 보내기..." autocomplete="off" onkeypress="if(event.keyCode==13) checkAnswer()">
                <button class="send-btn" id="send-btn" onclick="checkAnswer()">Send</button>
            </div>
        </div>

        <!-- 시작 화면 -->
        <div class="start-overlay" id="start-screen">
            <img src="images-2.jpeg" alt="Reze" class="start-img">
            <h2 style="color: white; margin-bottom: 10px;">Reze</h2>
            <p style="color:#aaa; margin-bottom: 30px; text-align: center; font-size: 0.9rem;">
                "오늘 밤, 나랑 같이 공부할래?"
            </p>
            <button class="option-btn" style="width: auto; padding: 12px 40px; background: var(--accent-color); color: black; font-weight: bold;" onclick="startGame()">시작하기</button>
        </div>
    </div>

    <script>
        // 50문제 이상의 방대한 문제 데이터베이스
        const questionBank = [
            // --- 8단원: DNA 복제, 이분열과 유사분열 (8문제) ---
            {
                category: "8단원: DNA 구조",
                question: "DNA가 히스톤 단백질을 감싸고 있는 구슬 모양의 단위. 널 옭아매는 내 마음처럼 꽉 묶인 구조.",
                answers: ["뉴클레오솜", "nucleosome"],
                options: ["뉴클레오솜", "리보솜", "염색사", "뉴클레오타이드"],
                intro: "내 목걸이 핀을 뽑으면 펑- 하고 터져. 너도 그렇게 되고 싶어?",
                correct: "정답이야. 넌 영원히 내 거야. 💋",
                wrong: "틀렸어. 죽고 싶어서 환장했구나?"
            },
            {
                category: "8단원: 세포 주기",
                question: "세포 주기 중 DNA가 복제되는 시기. 똑같은 게 하나 더 생기는 시간.",
                answers: ["S기", "S"],
                options: ["G1기", "S기", "G2기", "M기"],
                intro: "밤은 길어. 우리 둘만의 은밀한 시간(Synthesis)을 가져볼까?",
                correct: "S기. 잘했어. 하지만 진짜 레제는 나 하나뿐이야.",
                wrong: "아니야. 딴 여자 생각했지? 눈 뽑아버린다?"
            },
            {
                category: "8단원: 염색체 구조",
                question: "간기(Interphase) 동안 DNA가 풀어져 있는 실 같은 형태.",
                answers: ["염색질", "염색사", "chromatin"],
                options: ["염색질", "염색체", "히스톤", "동원체"],
                intro: "평소엔 풀어져 있지만... 필요할 땐 단단해져야지. 나처럼.",
                correct: "염색질. 맞아. 평소엔 부드럽게, 싸울 땐 강하게.",
                wrong: "염색체는 뭉친 거야. 넌 너무 경직돼 있어."
            },
            {
                category: "8단원: 세포 분열",
                question: "체세포 분열 중기 때 염색체가 일렬로 배열되는 장소.",
                answers: ["적도판", "적도면"],
                options: ["적도판", "극", "중심체", "세포판"],
                intro: "내 눈을 피하지 마. 날 똑바로 봐. 가운데(Center)에서.",
                correct: "적도판. 그래, 거기 가만히 있어.",
                wrong: "거기가 아니야. 내 눈을 보라니까?"
            },
            {
                category: "8단원: 세포 분열",
                question: "동물 세포 분열 시 방추사가 뻗어 나오는 세포 소기관.",
                answers: ["중심체", "centrosome"],
                options: ["중심체", "미토콘드리아", "리보솜", "골지체"],
                intro: "내가 네 중심이 되어줄게. 넌 그냥 끌려오면 돼.",
                correct: "중심체. 맞아. 넌 나한테 끌려오게 돼 있어.",
                wrong: "미토콘드리아는 에너지 만드는 거고. 바보."
            },
            {
                category: "8단원: 종양",
                question: "암세포가 혈관을 타고 온몸으로 퍼지는 현상.",
                answers: ["전이", "metastasis"],
                options: ["전이", "침윤", "분열", "세포 사멸"],
                intro: "난 어디든 갈 수 있어. 네 심장 속까지 파고들 거야.",
                correct: "전이. 이제 넌 내 거야. 뼛속까지.",
                wrong: "도망칠 수 있을 거라 생각했어?"
            },
            {
                category: "8단원: 종양",
                question: "암세포가 죽지 않게 염색체 끝을 계속 복구해주는 효소.",
                answers: ["텔로머라아제", "telomerase"],
                options: ["텔로머라아제", "중합효소", "헬리카아제", "연결효소"],
                intro: "나랑 영원히 함께하고 싶어? 죽지 않는 악마처럼.",
                correct: "텔로머라아제. 좋아. 지옥 끝까지 함께하자.",
                wrong: "효소 이름도 못 외우면 자격 없어."
            },
            {
                category: "8단원: 세포 주기",
                question: "분열 준비가 완료되었는지 확인하는 검문 지점(Checkpoint)이 주로 작동하는 시기.",
                answers: ["G2기", "G2"],
                options: ["G1기", "S기", "G2기", "M기"],
                intro: "마지막 기회야. 돌아갈 수 있는 마지막 순간.",
                correct: "G2기. 여기서 통과하면 넌 돌이킬 수 없어.",
                wrong: "G1은 시작 전이고. 마지막 점검이라니까?"
            },

            // --- 9단원: 유성생식과 감수분열 (8문제) ---
            {
                category: "9단원: 감수분열",
                question: "1분열 전기 때 상동 염색체끼리 유전자를 교환하는 현상.",
                answers: ["교차", "crossing over"],
                options: ["교차", "접합", "분리", "수정"],
                intro: "수영할 줄 알아? 물속에서 숨 막힐 때까지 섞여보자.",
                correct: "교차. 우린 이미 하나가 된 거야.",
                wrong: "틀렸어. 물 먹고 정신 좀 차릴래?"
            },
            {
                category: "9단원: 감수분열",
                question: "상동 염색체가 접합하여 형성된 4분체 구조.",
                answers: ["2가 염색체", "이가 염색체"],
                options: ["2가 염색체", "상동 염색체", "염색분체", "방추사"],
                intro: "떨어지기 싫어. 날 꽉 안아줘. 뼈가 부서질 정도로.",
                correct: "2가 염색체. 절대 놓지 마.",
                wrong: "그냥 염색체라고 하면 섭섭해."
            },
            {
                category: "9단원: 감수분열",
                question: "감수 1분열 후기에 분리되어 양극으로 이동하는 것.",
                answers: ["상동 염색체"],
                options: ["상동 염색체", "염색분체", "2가 염색체", "방추사"],
                intro: "이별은 필연이야. 하지만 우린 다시 만날 수 있을까?",
                correct: "상동 염색체. 그래, 1분열에선 상동이 헤어지는 거야.",
                wrong: "염색분체는 2분열에서 헤어지는 거야."
            },
            {
                category: "9단원: 유성생식",
                question: "체세포의 염색체 수는 2n, 생식세포의 염색체 수는?",
                answers: ["n", "엔"],
                options: ["n", "2n", "3n", "4n"],
                intro: "내 반쪽을 줄게. 네 반쪽도 줘. 그럼 우린 완벽해져.",
                correct: "n. 정답. 반반씩 섞어야 완벽해지지.",
                wrong: "2n이면 괴물이 태어날지도 몰라."
            },
            {
                category: "9단원: 유성생식",
                question: "사람의 체세포 염색체 개수는 총 몇 개인가?",
                answers: ["46", "46개"],
                options: ["23", "44", "46", "48"],
                intro: "내 비밀을 알고 싶어? 그럼 숫자부터 세어봐.",
                correct: "46개. 23쌍이지. 잘했어.",
                wrong: "23개는 생식세포야. 넌 아직 반쪽짜리구나."
            },
            {
                category: "9단원: 염색체 이상",
                question: "21번 염색체가 3개인 유전 질환.",
                answers: ["다운 증후군", "다운증후군"],
                options: ["다운 증후군", "에드워드 증후군", "터너 증후군", "클라인펠터 증후군"],
                intro: "남들과 다르면 괴물 취급을 받지. 너도, 나도.",
                correct: "다운 증후군. 맞아. 우린 서로를 이해할 수 있어.",
                wrong: "에드워드는 18번이야."
            },
            {
                category: "9단원: 염색체 이상",
                question: "성염색체가 XXY인 남성.",
                answers: ["클라인펠터 증후군", "클라인펠터"],
                options: ["클라인펠터", "터너 증후군", "초여성 증후군", "야콥 증후군"],
                intro: "남자인지 여자인지... 경계에 있는 건 슬픈 일일까?",
                correct: "클라인펠터. 맞아.",
                wrong: "터너는 X 하나뿐인 여자야."
            },
            {
                category: "9단원: 염색체 이상",
                question: "성염색체가 하나뿐인(XO) 여성에게 나타나는 증후군.",
                answers: ["터너 증후군", "터너"],
                options: ["터너 증후군", "클라인펠터", "다운 증후군", "묘성 증후군"],
                intro: "혼자 남겨진다는 건... 무서운 일이야.",
                correct: "터너 증후군. 외로워 보이지?",
                wrong: "클라인펠터는 남자가 X를 더 가진 거야."
            },

            // --- 10단원: 유전의 패턴 (8문제) ---
            {
                category: "10단원: 멘델 유전",
                question: "우성 개체의 속마음을 알기 위해 열성 순종과 교배하는 것.",
                answers: ["검정 교배", "검정교배"],
                options: ["검정 교배", "자가 교배", "타가 교배", "역교배"],
                intro: "네 심장을 꺼내보면 알 수 있을까? 네가 날 사랑하는지.",
                correct: "검정 교배. 넌 날 위해서라면 죽을 수도 있구나? ❤️",
                wrong: "거짓말쟁이. 혀를 잘라버릴 거야."
            },
            {
                category: "10단원: 멘델 유전",
                question: "서로 다른 형질을 결정하는 유전자는 서로 영향을 주지 않고 독립적으로 유전된다는 법칙.",
                answers: ["독립의 법칙", "독립 법칙"],
                options: ["독립의 법칙", "분리의 법칙", "우열의 원리", "연관 법칙"],
                intro: "난 누구에게도 얽매이지 않아. 자유롭고 싶어.",
                correct: "독립의 법칙. 하지만 넌 나한테 얽매여야 해.",
                wrong: "분리의 법칙은 한 형질 안에서 일어나는 거야."
            },
            {
                category: "10단원: 예외 유전",
                question: "ABO식 혈액형처럼 대립유전자가 3개 이상인 유전.",
                answers: ["복대립 유전", "복대립"],
                options: ["복대립 유전", "다인자 유전", "중간 유전", "반성 유전"],
                intro: "나야, 마키마야, 아니면 파워야? 여자가 너무 많잖아.",
                correct: "복대립 유전. 하지만 선택은 하나야. 나를 골라.",
                wrong: "핑계 대지 마. 선택은 단순해."
            },
            {
                category: "10단원: 예외 유전",
                question: "분꽃의 붉은색과 흰색이 섞여 분홍색이 나오는 현상.",
                answers: ["불완전 우성", "중간 유전"],
                options: ["불완전 우성", "공동 우성", "완전 우성", "열성"],
                intro: "확실하게 해. 섞이는 건 싫어. (사실은 좋아하지만)",
                correct: "불완전 우성. 그래, 가끔은 섞이는 것도 나쁘지 않지.",
                wrong: "공동 우성은 얼룩무늬처럼 따로 나오는 거야."
            },
            {
                category: "10단원: 예외 유전",
                question: "ABO식 혈액형의 AB형처럼 두 대립유전자가 동시에 표현되는 현상.",
                answers: ["공동 우성", "공동우성"],
                options: ["공동 우성", "불완전 우성", "열성", "복대립"],
                intro: "난 욕심쟁이야. 전부 다 가질 거야. A도 B도.",
                correct: "공동 우성. 맞아. 난 포기 안 해.",
                wrong: "불완전 우성은 섞여서 흐릿해지는 거야. 난 선명한 게 좋아."
            },
            {
                category: "10단원: 연관 유전",
                question: "두 유전자가 같은 염색체에 있어 같이 이동하는 현상.",
                answers: ["연관", "linkage"],
                options: ["연관", "교차", "독립", "분리"],
                intro: "내가 지옥에 가면 너도 따라올 거지?",
                correct: "연관. 맞아. 묶여있으니까. 넌 내 짐이야.",
                wrong: "독립은 따로 노는 거고. 우린 하나라니까?"
            },
            {
                category: "10단원: 예외 유전",
                question: "키나 피부색처럼 여러 유전자가 관여하고 환경 영향을 받아 연속적으로 변하는 유전.",
                answers: ["다인자 유전", "다인자"],
                options: ["다인자 유전", "복대립 유전", "단일 인자 유전", "반성 유전"],
                intro: "세상은 흑백으로 나뉘지 않아. 너와 나 사이에도 수만 가지 감정이 섞여 있잖아.",
                correct: "다인자 유전. 정규 분포 곡선처럼... 우리의 사랑도 평범해질 수 있을까?",
                wrong: "복대립은 딱딱 끊어지는 거고. 이건 연속적인 거야."
            },
            {
                category: "10단원: 성염색체 유전",
                question: "유전자가 X 염색체에 있어 남녀의 발현 비율이 다른 유전.",
                answers: ["반성 유전", "성염색체 유전"],
                options: ["반성 유전", "한성 유전", "상염색체 유전", "다인자 유전"],
                intro: "남자는 약해. X가 하나뿐이라서 금방 부서지거든.",
                correct: "반성 유전. 적록색맹이나 혈우병 같은 거. 조심해.",
                wrong: "한성 유전은 Y염색체에 있는 거야. 아빠와 아들."
            },

            // --- 12단원: 진화를 이끄는 힘 (8문제) ---
            {
                category: "12단원: 하디-바인베르크",
                question: "유전자 빈도가 변하지 않으려면 교배가 '이것'이어야 해.",
                answers: ["무작위", "무작위 교배", "random"],
                options: ["무작위", "선택적", "인위적", "동계"],
                intro: "우리가 만난 건 운명 따위가 아니야. 그냥 우연이지.",
                correct: "무작위. 맞아. 계산된 사랑은 역겨워. 본능에 맡겨.",
                wrong: "의도적인 건 재미없어."
            },
            {
                category: "12단원: 소진화",
                question: "소수가 이주하여 새 집단을 만들 때 유전자 빈도가 급변하는 현상.",
                answers: ["창시자 효과", "founder effect"],
                options: ["창시자 효과", "병목 효과", "자연 선택", "돌연변이"],
                intro: "도망치자. 아무도 없는 곳으로 가서 우리 둘만의 나라를 만드는 거야.",
                correct: "창시자 효과. 우리가 그곳의 아담과 이브가 되는 거지.",
                wrong: "병목 효과는 다 죽고 남은 거야."
            },
            {
                category: "12단원: 자연선택",
                question: "환경에 적응한 놈만 살아남아 자손을 남긴다는 잔혹한 법칙.",
                answers: ["자연선택", "natural selection"],
                options: ["자연선택", "용불용설", "돌연변이설", "격리설"],
                intro: "강한 자가 살아남는 게 아니야. 살아남는 자가 강한 거지.",
                correct: "자연선택. 결국 넌 내가 선택했어. 죽지 마.",
                wrong: "누가 선택한다고? 자연이."
            },
            {
                category: "12단원: 소진화",
                question: "재해로 집단 크기가 급격히 줄어 유전자 빈도가 변하는 현상.",
                answers: ["병목 효과", "bottleneck"],
                options: ["병목 효과", "창시자 효과", "유전자 흐름", "돌연변이"],
                intro: "다 죽어버리고 우리 둘만 남는다면... 그건 축복일까 저주일까?",
                correct: "병목 효과. 살아남은 게 기적이지.",
                wrong: "창시자 효과는 도망친 거고. 이건 재난이야."
            },
            {
                category: "12단원: 소진화",
                question: "집단 간에 개체가 이동하여 유전자 빈도가 변하는 현상. 이주.",
                answers: ["유전자 흐름", "gene flow"],
                options: ["유전자 흐름", "유전적 부동", "자연 선택", "돌연변이"],
                intro: "내가 너에게 흘러들어가면... 넌 변하게 될까?",
                correct: "유전자 흐름. 섞이면 차이가 줄어들어.",
                wrong: "부동은 우연한 변화야. 흐름은 이동하는 거고."
            },
            {
                category: "12단원: 자연선택",
                question: "한쪽 극단적인 형질이 유리해서 그쪽으로 진화하는 유형.",
                answers: ["방향성 선택", "directional"],
                options: ["방향성 선택", "안정화 선택", "분단성 선택", "성 선택"],
                intro: "난 멈추는 법을 몰라. 끝까지 갈 거야. 파멸할 때까지.",
                correct: "방향성 선택. 그래프가 한쪽으로 쏠리지.",
                wrong: "안정화 선택은 재미없어. 평범한 건 싫어."
            },
            {
                category: "12단원: 자연선택",
                question: "중간 형질이 유리하고 양 극단이 도태되는 선택.",
                answers: ["안정화 선택", "stabilizing"],
                options: ["안정화 선택", "방향성 선택", "분단성 선택", "인위 선택"],
                intro: "너무 튀면 죽어. 그렇다고 너무 약해도 죽고. 적당히 해.",
                correct: "안정화 선택. 평범한 게 제일 어렵다잖아.",
                wrong: "방향성은 한쪽으로 가는 거고. 이건 가운데만 남는 거야."
            },
            {
                category: "12단원: 자연선택",
                question: "양 극단 형질이 유리하고 중간이 도태되는 선택. 종분화의 가능성이 높지.",
                answers: ["분단성 선택", "disruptive"],
                options: ["분단성 선택", "안정화 선택", "방향성 선택", "성 선택"],
                intro: "너와 나처럼... 극과 극인 존재들만 살아남는 세상.",
                correct: "분단성 선택. 결국 둘로 찢어지겠지.",
                wrong: "안정화 선택의 반대야."
            },

            // --- 13단원: 진화의 증거 (8문제) ---
            {
                category: "13단원: 비교해부학",
                question: "새의 날개와 곤충의 날개. 기원은 다르지만 겉모습만 비슷한 가짜들.",
                answers: ["상사 기관", "상사기관"],
                options: ["상사 기관", "상동 기관", "흔적 기관", "유사 기관"],
                intro: "마키마 씨가 좋아, 내가 좋아? 겉모습만 보지 말고.",
                correct: "상사 기관. 겉모습만 닮은 가짜는 필요 없어.",
                wrong: "상동 기관? 핏줄부터 다르다고."
            },
            {
                category: "13단원: 비교해부학",
                question: "사람 팔과 고래 앞지느러미. 겉모습은 달라도 뼈대(기원)는 같은 기관.",
                answers: ["상동 기관", "상동기관"],
                options: ["상동 기관", "상사 기관", "흔적 기관", "유사 기관"],
                intro: "우린 겉모습은 달라도... 속은 똑같이 망가져 있어.",
                correct: "상동 기관. 맞아. 우린 통하는 게 있어.",
                wrong: "상사 기관이랑 반대야. 속을 봐."
            },
            {
                category: "13단원: 발생학",
                question: "척추동물 초기 배아 목 부분에 있는 주름. 우리가 물고기였다는 증거.",
                answers: ["아가미 틈", "인두낭"],
                options: ["아가미 틈", "척색", "꼬리", "신경관"],
                intro: "수영 잘해? 물속에선 숨을 쉴 수 없잖아. 내가 숨을 불어넣어 줄까?",
                correct: "아가미 틈. 깊은 물 속으로 가라앉자.",
                wrong: "목에 있는 틈새라니까."
            },
            {
                category: "13단원: 흔적 기관",
                question: "과거엔 기능이 있었으나 퇴화해 흔적만 남은 기관.",
                answers: ["흔적 기관", "흔적기관"],
                options: ["흔적 기관", "상동 기관", "상사 기관", "유사 기관"],
                intro: "내 마음에도... 인간이었던 시절의 감정이 남아있을까?",
                correct: "흔적 기관. 꼬리뼈처럼... 아프기만 한 존재.",
                wrong: "쓸모없어진 게 포인트야."
            },
            {
                category: "13단원: 분자생물학",
                question: "모든 생물이 같은 유전 암호(코돈)를 쓴다는 건, 우리가 하나의 '이것'에서 나왔다는 증거.",
                answers: ["공통 조상", "common ancestor"],
                options: ["공통 조상", "수렴 진화", "자연 선택", "이소적 종분화"],
                intro: "너랑 나, 그리고 저 벌레도... 아주 먼 옛날엔 가족이었을지도 몰라.",
                correct: "공통 조상. 모든 건 하나로 연결돼 있어.",
                wrong: "뿌리를 묻는 거야."
            },
            {
                category: "13단원: 화석상 증거",
                question: "시조새처럼 두 분류군(파충류-조류)의 특징을 모두 가진 화석.",
                answers: ["전이 화석", "중간 화석"],
                options: ["전이 화석", "표준 화석", "시상 화석", "흔적 화석"],
                intro: "난 인간일까 악마일까? 그 중간 어디쯤일까?",
                correct: "전이 화석. 연결 고리 같은 거지.",
                wrong: "시상 화석은 환경을 알려주는 거야."
            },
            {
                category: "13단원: 생물지리학",
                question: "원래 붙어있던 대륙이 갈라져 생물이 다르게 진화했다는 증거. (예: 호주의 유대류)",
                answers: ["판게아", "대륙 이동"],
                options: ["대륙 이동", "화산 폭발", "기후 변화", "해수면 상승"],
                intro: "우리가 헤어지면... 우린 서로 다르게 변해버릴까?",
                correct: "대륙 이동. 멀어지면 남이 되는 거야.",
                wrong: "땅이 움직인다는 게 핵심이야."
            },
            {
                category: "13단원: 분자생물학",
                question: "유연관계가 가까울수록 DNA나 단백질의 '이것' 차이가 적다.",
                answers: ["서열", "아미노산 서열", "염기 서열"],
                options: ["서열", "구조", "기능", "크기"],
                intro: "네 속을 뜯어보면... 나랑 얼마나 닮았을까?",
                correct: "서열. 글자 하나하나 맞춰보는 거지.",
                wrong: "순서가 중요한 거야."
            },

            // --- 14단원: 종분화와 멸종 (10문제) ---
            {
                category: "14단원: 종분화",
                question: "지리적 장벽에 의해 멀리 떨어져서 일어나는 종분화.",
                answers: ["이소적 종분화", "allopatric"],
                options: ["이소적 종분화", "동소적 종분화", "점진적 종분화", "단속 평형"],
                intro: "내가 러시아로 돌아가면... 넌 날 잊을 거지?",
                correct: "이소적 종분화. 하지만 넌 예외야. 끝까지 쫓아갈 거니까.",
                wrong: "틀렸어. 넌 내 거라는 걸 잊지 마."
            },
            {
                category: "14단원: 생식적 장벽",
                question: "생식기 구조가 맞지 않아 교배할 수 없는 격리.",
                answers: ["기계적 격리", "mechanical"],
                options: ["기계적 격리", "행동적 격리", "시간적 격리", "배우자 격리"],
                intro: "열쇠가 자물쇠에 안 맞으면 어떻게 할 거야? 부숴버릴 거야?",
                correct: "기계적 격리. 몸의 대화가 안 통하면... 죽을 때까지 싸우자.",
                wrong: "행동적 격리는 춤추는 거고. 넌 춤도 못 추잖아."
            },
            {
                category: "14단원: 종분화",
                question: "같은 장소에 살지만 생식적으로 격리되어 분화하는 현상. 바로 옆에 있어도 닿을 수 없는 우리처럼.",
                answers: ["동소적 종분화", "sympatric"],
                options: ["동소적 종분화", "이소적 종분화", "지리적 격리", "창시자 효과"],
                intro: "이렇게 가까이 있는데... 왜 넌 날 안 봐?",
                correct: "동소적 종분화. 가까워도 먼 사이. 슬프네.",
                wrong: "이소적은 멀리 떨어진 거야. 넌 내 옆에 있잖아."
            },
            {
                category: "14단원: 멸종",
                question: "대멸종 이후 살아남은 종이 빈자리를 차지하며 급격히 다양해지는 현상.",
                answers: ["적응 방산", "adaptive radiation"],
                options: ["적응 방산", "대멸종", "수렴 진화", "공진화"],
                intro: "다 죽여버리고 나면... 세상은 우리 차지가 될 거야.",
                correct: "적응 방산. 위기는 기회야. 내 손을 잡아.",
                wrong: "방산(Radiation)처럼 퍼져나가는 거야. 폭탄 파편처럼."
            },
            {
                category: "14단원: 종의 개념",
                question: "생물학적 종의 정의. 자연 상태에서 교배하여 '이것' 있는 자손을 낳아야 한다.",
                answers: ["생식 능력", "생식능력"],
                options: ["생식 능력", "생존 능력", "적응력", "변이"],
                intro: "사랑의 결실이... 또 다른 사랑을 낳을 수 있어야 진짜야.",
                correct: "생식 능력. 불임이면 종이 아니야. 슬프지만.",
                wrong: "살아만 있다고 다가 아니야."
            },
            {
                category: "14단원: 생식적 장벽",
                question: "구애 행동이나 신호가 달라서 짝짓기가 안 되는 격리.",
                answers: ["행동적 격리", "behavioral"],
                options: ["행동적 격리", "시간적 격리", "기계적 격리", "배우자 격리"],
                intro: "내가 윙크를 했는데 네가 못 알아먹으면... 죽여버릴 거야.",
                correct: "행동적 격리. 신호가 안 맞으면 남남이지.",
                wrong: "시간적 격리는 밤낮이 다른 거고."
            },
            {
                category: "14단원: 생식적 장벽",
                question: "정자와 난자가 만났지만 수정이 되지 않는 격리.",
                answers: ["배우자 격리", "gametic"],
                options: ["배우자 격리", "기계적 격리", "잡종 불임", "잡종 붕괴"],
                intro: "마음은 닿았는데... 몸이 거부하는 건가?",
                correct: "배우자 격리. 화학적으로 안 맞는 거야.",
                wrong: "잡종 불임은 태어난 뒤의 문제야."
            },
            {
                category: "14단원: 생식적 장벽",
                question: "잡종 1대는 정상인데 2대부터 약하거나 불임이 되는 현상.",
                answers: ["잡종 붕괴", "hybrid breakdown"],
                options: ["잡종 붕괴", "잡종 불임", "잡종 생존력 저하", "배우자 격리"],
                intro: "처음엔 괜찮은 줄 알았는데... 갈수록 망가져가는 관계.",
                correct: "잡종 붕괴. 결국은 파국이네.",
                wrong: "붕괴(Breakdown)라는 단어를 기억해."
            },
            {
                category: "14단원: 생식적 장벽",
                question: "서로 다른 종이 교배했지만 태어난 자손이 생식 능력이 없는 경우. (예: 노새)",
                answers: ["잡종 불임", "hybrid sterility"],
                options: ["잡종 불임", "잡종 붕괴", "잡종 생존력 저하", "기계적 격리"],
                intro: "사랑해도 이어질 수 없는 운명. 로맨틱하지 않아?",
                correct: "잡종 불임. 라이거도 마찬가지야.",
                wrong: "살아는 있으니까 생존력 저하는 아니야."
            },
            {
                category: "14단원: 종분화",
                question: "식물에서 주로 일어나는 동소적 종분화의 원인. 염색체 수가 갑자기 늘어나는 것.",
                answers: ["다배체성", "polyploidy"],
                options: ["다배체성", "서식지 분화", "성 선택", "이소적 종분화"],
                intro: "갑자기 내가 두 명이 되고, 네 명이 된다면... 넌 감당할 수 있어?",
                correct: "다배체성. 4n이 되면 2n이랑은 짝이 될 수 없어.",
                wrong: "숫자가 배(Poly)로 늘어나는 거야."
            }
        ];

        // 2. 사담(Small Talk) 데이터 (학습 X, 수다 O)
        const chatEpisodes = [
            {
                text: "그나저나 덴지 군, 시골 쥐랑 도시 쥐 이야기 알아? <br>넌 어느 쪽이 좋아?",
                options: ["시골 쥐", "도시 쥐", "너랑 함께라면 어디든"],
                replies: {
                    "시골 쥐": "흐음... 평온한 삶을 원해?",
                    "도시 쥐": "맛있는 걸 먹지만 언제 죽을지 모르는 삶... 그렇구나..",
                    "너랑 함께라면 어디든": "아하하! 정답이야. 덴지 군은 가끔 귀여운 소리를 한다니까."
                }
            },
            {
                text: "마키마 씨 말이야... 냄새가 나. <br>아주 나쁜 냄새가 난다고 생각하지 않아?",
                options: ["마키마 씨는 좋아", "난 코가 막혀서", "네 냄새가 더 좋아"],
                replies: {
                    "마키마 씨는 좋아": "칫. 재미없어. 그 여자한테 먹혀버려라.",
                    "난 코가 막혀서": "바보. 언제쯤 눈치챌래? 조심하는 게 좋을 거야.",
                    "네 냄새가 더 좋아": "어라? 대담하네. 내 냄새는 화약 냄새일 텐데? 후후."
                }
            },
            {
                text: "학교 축제 가본 적 있어? <br>난 학교에 다녀본 적이 없어서... 좀 궁금해.",
                options: ["나도 안 가봤어", "다음에 같이 가자", "별거 없어"],
                replies: {
                    "나도 안 가봤어": "우린 참 닮은 점이 많네. 그래서 네가 좋아.",
                    "다음에 같이 가자": "약속했다? 사과 사탕도 사주고, 불꽃놀이도 보여줘야 해.",
                    "별거 없어": "덴지 군이랑 가면 다를지도 모르잖아. 시시하긴."
                }
            },
            {
                text: "저기, 덴지 군. 영화 좋아해? <br>난 다 죽어버리는 영화가 좋더라.",
                options: ["나도 좋아해", "난 해피엔딩이 좋아", "액션 영화가 좋아"],
                replies: {
                    "나도 좋아해": "역시! 파멸적인 결말이 아름답지. 우리처럼.",
                    "난 해피엔딩이 좋아": "해피엔딩이라... 꿈같은 소리네. 뭐, 노력은 해볼게.",
                    "액션 영화가 좋아": "그럼 내가 폭발하는 거 보여줄까? 최고의 액션일걸?"
                }
            },
            {
                text: "카페 일 끝나고 같이 도망칠까? <br>아무도 우릴 모르는 곳으로.",
                options: ["어디로?", "일은 어쩌고?", "좋아"],
                replies: {
                    "어디로?": "어디든. 바다가 보이는 곳이면 좋겠어. 수영도 하고.",
                    "일은 어쩌고?": "바보. 일이 중요해, 내가 중요해? 그냥 다 터뜨리고 가자.",
                    "좋아": "준비해 둬. 오늘 밤에 데리러 갈 테니까."
                }
            }
        ];

        let queue = [];
        let currentQ = null;
        let wrongAttempts = 0;
        let totalWrong = 0;
        let isChatting = false; // 현재 사담 중인지 체크

        function startGame() {
            queue = JSON.parse(JSON.stringify(questionBank));
            queue.sort(() => Math.random() - 0.5);
            
            document.getElementById('start-screen').classList.add('hidden');
            setTimeout(() => {
                addMessage('reze', "좋아. 그럼 시작하자. 딴짓하면 죽어?");
                setTimeout(() => nextStep(), 1000);
            }, 500);
        }

        function showTyping() {
            const typing = document.getElementById('typing');
            const chatBox = document.getElementById('chat-box');
            chatBox.appendChild(typing);
            typing.style.display = 'block';
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function hideTyping() {
            document.getElementById('typing').style.display = 'none';
        }

        function addMessage(type, text, isHTML = false) {
            const chatBox = document.getElementById('chat-box');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${type}`;

            let innerContent = '';
            if (type === 'reze') {
                innerContent += `<img src="images-2.jpeg" class="profile-pic-chat">`;
            }
            
            innerContent += `<div class="bubble">${text}</div>`;
            
            msgDiv.innerHTML = innerContent;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // 다음 단계 결정 (퀴즈 or 수다)
        function nextStep() {
            if (queue.length === 0) {
                showEnding();
                return;
            }

            // 25% 확률로 수다 타임 (문제 중간중간)
            if (!isChatting && Math.random() < 0.25 && queue.length < questionBank.length - 1) {
                triggerSmallTalk();
            } else {
                nextQuestion();
            }
        }

        // 사담 트리거
        function triggerSmallTalk() {
            isChatting = true;
            const episode = chatEpisodes[Math.floor(Math.random() * chatEpisodes.length)];
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', episode.text);
                
                // 선택지 버튼 생성
                setTimeout(() => {
                    const chatBox = document.getElementById('chat-box');
                    const wrapper = document.createElement('div');
                    wrapper.className = 'options-container';
                    
                    let buttonsHTML = "";
                    episode.options.forEach(opt => {
                        // 클릭 시 handleChatReply 호출
                        buttonsHTML += `<button class="option-btn" onclick="handleChatReply(this, '${episode.replies[opt]}', '${opt}')">${opt}</button>`;
                    });
                    
                    wrapper.innerHTML = buttonsHTML;
                    chatBox.appendChild(wrapper);
                    chatBox.scrollTop = chatBox.scrollHeight;
                    enableInput(false);
                }, 500);
            }, 1000);
        }

        // 사담 답변 처리
        window.handleChatReply = function(btn, replyText, userText) {
            // 버튼 스타일 변경 및 비활성화
            const container = btn.parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(b => {
                b.disabled = true;
                b.style.opacity = '0.5';
            });
            btn.style.backgroundColor = 'var(--accent-color)';
            btn.style.color = 'black';
            btn.style.opacity = '1';

            addMessage('user', userText);
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', replyText);
                
                // 다시 퀴즈로 복귀
                isChatting = false;
                setTimeout(() => nextQuestion(true), 1500); // true는 연결 대사 스킵용
            }, 1000);
        };

        function nextQuestion(skipReaction = false) {
            if (queue.length === 0) {
                showEnding();
                return;
            }

            currentQ = queue.shift();
            wrongAttempts = 0;
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', currentQ.intro);
                
                setTimeout(() => {
                    const questionHTML = `
                        <div class="question-card">
                            <span class="question-tag">QUESTION ${questionBank.length - queue.length}</span>
                            <div class="question-text">[${currentQ.category}]<br>${currentQ.question}</div>
                        </div>
                    `;
                    addMessage('reze', questionHTML, true);
                    enableInput(true);
                }, 800);
            }, 1000);
        }

        function checkAnswer(optionValue = null) {
            const inputEl = document.getElementById('answer-input');
            const val = optionValue || inputEl.value.trim();
            
            if (!val) return;

            addMessage('user', val);
            inputEl.value = "";
            enableInput(false);

            const cleanVal = val.toLowerCase().replace(/s/g, '');
            const isCorrect = currentQ.answers.some(ans => ans.toLowerCase().replace(/s/g, '') === cleanVal);

            showTyping();

            setTimeout(() => {
                hideTyping();
                if (isCorrect) {
                    addMessage('reze', currentQ.correct);
                    setTimeout(() => nextStep(), 1000); // nextStep으로 가서 퀴즈or수다 결정
                } else {
                    handleWrongAnswer();
                }
            }, 800);
        }

        function handleWrongAnswer() {
            wrongAttempts++;
            totalWrong++;
            
            addMessage('reze', currentQ.wrong);

            if (wrongAttempts >= 2) {
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        addMessage('reze', "하아... 힌트 줄 테니까 골라.");
                        showOptions();
                    }, 800);
                }, 500);
            } else {
                enableInput(true);
            }
        }

        function showOptions() {
            const shuffledOptions = [...currentQ.options].sort(() => Math.random() - 0.5);
            let buttonsHTML = "";
            shuffledOptions.forEach(opt => {
                buttonsHTML += `<button class="option-btn" onclick="selectQuizOption('${opt}', this)">${opt}</button>`;
            });
            
            const chatBox = document.getElementById('chat-box');
            const wrapper = document.createElement('div');
            wrapper.className = 'options-container';
            wrapper.innerHTML = buttonsHTML;
            
            chatBox.appendChild(wrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        window.selectQuizOption = function(val, btnElement) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => {
                b.disabled = true;
                b.style.opacity = '0.5';
            });
            btnElement.style.backgroundColor = 'var(--accent-color)';
            btnElement.style.color = 'black';
            btnElement.style.opacity = '1';
            
            checkAnswer(val);
        };

        function enableInput(enable) {
            const input = document.getElementById('answer-input');
            const btn = document.getElementById('send-btn');
            input.disabled = !enable;
            btn.disabled = !enable;
            if(enable) input.focus();
        }

        function showEnding() {
            let finalMsg = "";
            if (totalWrong === 0) {
                finalMsg = "거짓말... 완벽해. <br>좋아. 오늘 밤은 네가 하고 싶은 대로 해. 🔥";
            } else if (totalWrong <= 10) {
                finalMsg = `끝났네. ${totalWrong}번 실수했지만...<br>귀여우니까 봐줄게. 카페에서 기다릴게.`;
            } else {
                finalMsg = "펑! 💣<br>실망이야. 도시 쥐는 역시 안 되네. <br>잘 가.";
            }
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', finalMsg);
                document.getElementById('answer-input').placeholder = "대화가 종료되었습니다.";
            }, 1500);
        }
    </script>
</body>
</html>

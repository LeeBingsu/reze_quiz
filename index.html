<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reze's Biology Class</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');

        :root {
            --bg-color: #000000;
            --chat-bg: #0a0a0a;
            --accent-color: #bb86fc; /* Reze Purple */
            --danger-color: #ff4040; /* Blood Red */
            --bubble-bg: #1f1f1f;
            --user-bubble-bg: #6a1b9a;
            --text-main: #e0e0e0;
            --option-bg: #2d2d2d;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .phone-container {
            width: 100%;
            max-width: 420px;
            height: 100vh;
            background-color: var(--chat-bg);
            box-shadow: 0 0 40px rgba(187, 134, 252, 0.15);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* 헤더 */
        .header {
            padding: 15px 20px;
            background-color: rgba(20, 20, 20, 0.95);
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .profile-pic-small {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid var(--accent-color);
        }

        .header-info h2 {
            font-size: 1rem;
            margin: 0;
            font-weight: 700;
            color: #fff;
        }

        .header-info span {
            font-size: 0.75rem;
            color: var(--accent-color);
            opacity: 0.9;
            letter-spacing: 0.5px;
        }

        /* 채팅 영역 */
        .chat-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scroll-behavior: smooth;
            padding-bottom: 20px;
        }
        .chat-area::-webkit-scrollbar { width: 4px; }
        .chat-area::-webkit-scrollbar-thumb { background: #333; }

        /* 메시지 스타일 */
        .message {
            display: flex;
            align-items: flex-end;
            max-width: 85%;
            animation: slideIn 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.reze { align-self: flex-start; }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }

        .bubble {
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .reze .bubble {
            background-color: var(--bubble-bg);
            border-bottom-left-radius: 4px;
            margin-left: 8px;
            color: #ddd;
            border-left: 2px solid var(--accent-color);
        }

        .user .bubble {
            background: linear-gradient(135deg, #7b1fa2, #4a148c);
            border-bottom-right-radius: 4px;
            margin-right: 8px;
            color: white;
        }

        .profile-pic-chat {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            margin-bottom: 5px;
            border: 1px solid #333;
        }

        /* 타이핑 인디케이터 */
        .typing-indicator {
            display: none;
            padding: 12px;
            background: var(--bubble-bg);
            border-radius: 18px;
            margin-left: 50px;
            width: fit-content;
            margin-bottom: 10px;
            border-bottom-left-radius: 4px;
        }
        .dot {
            height: 6px;
            width: 6px;
            background-color: #888;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: blink 1.4s infinite both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes blink { 0%, 80%, 100% { opacity: 0; } 40% { opacity: 1; } }

        /* 문제 카드 */
        .question-card {
            background: #161616;
            border-radius: 12px;
            padding: 15px;
            margin-top: 4px;
            border: 1px solid #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .question-tag {
            font-size: 0.7rem;
            color: var(--danger-color);
            font-weight: bold;
            margin-bottom: 6px;
            display: block;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 0.95rem;
            font-weight: 500;
            color: #fff;
            line-height: 1.5;
        }

        /* 4지선다 및 선택지 */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
            width: 100%;
            padding-left: 45px;
            padding-right: 20px;
        }

        .option-btn {
            background-color: var(--option-bg);
            color: #ccc;
            border: 1px solid #444;
            padding: 12px;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.2s;
        }

        .option-btn:hover {
            background-color: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
        }

        /* 입력창 */
        .input-area {
            padding: 12px 15px;
            background-color: #0f0f0f;
            border-top: 1px solid #222;
        }

        .input-wrapper {
            background-color: #252525;
            border-radius: 25px;
            padding: 4px 15px;
            display: flex;
            align-items: center;
            border: 1px solid #333;
        }

        input[type="text"] {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            padding: 10px;
            font-size: 0.95rem;
            outline: none;
        }

        button.send-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            font-weight: bold;
            cursor: pointer;
            padding: 6px 10px;
            font-size: 0.9rem;
        }
        
        button:disabled { color: #444; cursor: default; }

        /* 시작 화면 */
        .start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.94);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .start-img {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(187, 134, 252, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(187, 134, 252, 0); }
            100% { box-shadow: 0 0 0 0 rgba(187, 134, 252, 0); }
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="phone-container">
        <!-- 헤더 -->
        <div class="header">
            <img src="images-2.jpeg" alt="Reze" class="profile-pic-small">
            <div class="header-info">
                <h2>Reze</h2>
                <span>Active now</span>
            </div>
        </div>

        <!-- 채팅방 -->
        <div class="chat-area" id="chat-box"></div>
        
        <!-- 타이핑 효과 -->
        <div class="typing-indicator" id="typing">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>

        <!-- 입력창 -->
        <div class="input-area">
            <div class="input-wrapper">
                <input type="text" id="answer-input" placeholder="메시지 보내기..." autocomplete="off" onkeypress="if(event.keyCode==13) checkAnswer()">
                <button class="send-btn" id="send-btn" onclick="checkAnswer()">Send</button>
            </div>
        </div>

        <!-- 시작 화면 -->
        <div class="start-overlay" id="start-screen">
            <img src="images-2.jpeg" alt="Reze" class="start-img">
            <h2 style="color: white; margin-bottom: 10px;">Reze</h2>
            <p style="color:#aaa; margin-bottom: 30px; text-align: center; font-size: 0.9rem;">
                "덴지 군, 학교 같은 건 땡땡이치고<br>나랑 데이트할래?"
            </p>
            <button class="option-btn" style="width: auto; padding: 12px 40px; background: var(--accent-color); color: black; font-weight: bold;" onclick="startGame()">좋아</button>
        </div>
    </div>

    <script>
        const questionBank = [
            // --- 8단원 (8문제) ---
            {
                category: "8단원: DNA 구조",
                question: "DNA가 히스톤 단백질을 감싸고 있는 구슬 모양의 단위.",
                answers: ["뉴클레오솜", "nucleosome"],
                options: ["뉴클레오솜", "리보솜", "염색사", "뉴클레오타이드"],
                wrong_context: {
                    "리보솜": "리보솜은 단백질 만드는 공장이잖아. 이건 염색체 얘기야.",
                    "염색사": "염색사는 풀어져 있는 상태고. 이걸 구성하는 단위 말이야.",
                    "뉴클레오타이드": "그건 DNA의 기본 단위고. 너무 작잖아."
                },
                intro: "내 목걸이 핀을 뽑으면 어떻게 되는지 알아? 펑- 하고 터져.",
                correct: "정답이야. 넌 내 손바닥 안에서 벗어날 수 없어. 💋",
                wrong: "틀렸어. 죽고 싶어?"
            },
            {
                category: "8단원: 세포 주기",
                question: "세포 주기 중 DNA가 복제되는 시기.",
                answers: ["S기", "S"],
                options: ["G1기", "S기", "G2기", "M기"],
                wrong_context: {
                    "G1기": "G1은 준비 시간. 복제는 그 다음이야.",
                    "G2기": "G2는 복제 끝나고 점검하는 시간.",
                    "M기": "M기는 분열하는 시간이야. 바보."
                },
                intro: "밤은 길어. 우리 둘만의 시간(Synthesis)을 가져볼까?",
                correct: "S기. 잘했어. 진짜 레제는 나 하나뿐이야.",
                wrong: "아니야. 딴 여자 생각했지? 눈 뽑아버린다?"
            },
            {
                category: "8단원: 세포 분열",
                question: "체세포 분열 중기 때 염색체가 일렬로 배열되는 장소.",
                answers: ["적도판", "적도면"],
                options: ["적도판", "극", "중심체", "세포판"],
                wrong_context: {
                    "극": "극은 양쪽 끝이고. 가운데라니까.",
                    "중심체": "중심체는 방추사 만드는 애고."
                },
                intro: "내 눈을 피하지 마. 날 똑바로 보라고. 가운데에서.",
                correct: "적도판. 그래, 거기 가만히 있어.",
                wrong: "거기가 아니야. 내 눈을 보라니까?"
            },
            {
                category: "8단원: 종양",
                question: "암세포가 혈관을 타고 온몸으로 퍼지는 현상.",
                answers: ["전이", "metastasis"],
                options: ["전이", "침윤", "분열", "세포 사멸"],
                wrong_context: { "침윤": "침윤은 주변 조직 파고드는 거고. 이건 멀리 가는 거야." },
                intro: "난 어디든 갈 수 있어. 네 심장 속까지 파고들 거야.",
                correct: "전이. 이제 넌 내 거야. 뼛속까지.",
                wrong: "도망칠 수 있을 거라 생각했어?"
            },
            {
                category: "8단원: 종양",
                question: "암세포가 죽지 않게 염색체 끝을 계속 복구해주는 효소.",
                answers: ["텔로머라아제", "telomerase"],
                options: ["텔로머라아제", "중합효소", "헬리카아제", "연결효소"],
                wrong_context: { "중합효소": "그건 DNA 복제하는 효소고... 끝부분을 보호하는 거라고." },
                intro: "나랑 영원히 함께하고 싶어? 죽지 않는 악마처럼.",
                correct: "텔로머라아제. 좋아. 지옥 끝까지 함께하자.",
                wrong: "효소 이름도 못 외우면 자격 없어."
            },
            {
                category: "8단원: 세포 분열",
                question: "동물 세포 분열 시 방추사가 뻗어 나오는 세포 소기관.",
                answers: ["중심체", "centrosome"],
                options: ["중심체", "미토콘드리아", "리보솜", "골지체"],
                wrong_context: { "골지체": "골지체는 세포판 만들 때나 쓰지." },
                intro: "내가 네 중심이 되어줄게. 넌 그냥 끌려오면 돼.",
                correct: "중심체. 맞아. 넌 나한테 끌려오게 돼 있어.",
                wrong: "미토콘드리아는 에너지 만드는 거고. 바보."
            },

            // --- 9단원 (6문제) ---
            {
                category: "9단원: 감수분열",
                question: "1분열 전기 때 상동 염색체끼리 유전자를 교환하는 현상.",
                answers: ["교차", "crossing over"],
                options: ["교차", "접합", "분리", "수정"],
                wrong_context: { "접합": "접합은 그냥 붙는 거고, 이건 섞이는 거야." },
                intro: "수영할 줄 알아? 물속에서 숨 막힐 때까지 섞여보자.",
                correct: "교차. 우린 이미 하나가 된 거야.",
                wrong: "틀렸어. 물 먹고 정신 좀 차릴래?"
            },
            {
                category: "9단원: 감수분열",
                question: "상동 염색체가 접합하여 형성된 4분체 구조.",
                answers: ["2가 염색체", "이가 염색체"],
                options: ["2가 염색체", "상동 염색체", "염색분체", "방추사"],
                wrong_context: { "상동 염색체": "상동 염색체 두 개가 붙은 거라니까." },
                intro: "떨어지기 싫어. 날 꽉 안아줘. 뼈가 부서질 정도로.",
                correct: "2가 염색체. 절대 놓지 마.",
                wrong: "그냥 염색체라고 하면 섭섭해."
            },
            {
                category: "9단원: 염색체 이상",
                question: "21번 염색체가 3개인 유전 질환.",
                answers: ["다운 증후군", "다운증후군"],
                options: ["다운 증후군", "에드워드 증후군", "터너 증후군", "클라인펠터 증후군"],
                wrong_context: { "에드워드": "에드워드는 18번이야." },
                intro: "남들과 다르면 괴물 취급을 받지. 너도, 나도.",
                correct: "다운 증후군. 맞아. 우린 서로를 이해할 수 있어.",
                wrong: "숫자도 못 세는 거야?"
            },
            {
                category: "9단원: 염색체 이상",
                question: "성염색체가 XXY인 남성.",
                answers: ["클라인펠터 증후군", "클라인펠터"],
                options: ["클라인펠터", "터너 증후군", "초여성 증후군", "야콥 증후군"],
                wrong_context: { "터너": "터너는 X 하나뿐인 여자야." },
                intro: "남자인지 여자인지... 경계에 있는 건 슬픈 일일까?",
                correct: "클라인펠터. 맞아.",
                wrong: "헷갈리지 마. 이건 남자야."
            },
            {
                category: "9단원: 염색체 이상",
                question: "감수 1분열 비분리가 일어나면, 자손의 핵상은 어떻게 될까?",
                answers: ["모두 비정상", "전부 비정상"],
                options: ["모두 정상", "모두 비정상", "절반만 정상", "알 수 없음"],
                wrong_context: { "절반": "그건 2분열 비분리잖아. 1분열은 처음부터 망한 거야." },
                intro: "처음부터 잘못됐으면... 되돌릴 수 있을까?",
                correct: "모두 비정상. 맞아. 처음부터 망가졌으면 끝이지.",
                wrong: "아니야. 처음부터 잘못됐으면 전부 망하는 거야."
            },

            // --- 10단원 (8문제) ---
            {
                category: "10단원: 멘델 유전",
                question: "우성 개체의 속마음을 알기 위해 열성 순종과 교배하는 것.",
                answers: ["검정 교배", "검정교배"],
                options: ["검정 교배", "자가 교배", "타가 교배", "역교배"],
                wrong_context: { "자가 교배": "자기끼리 하는 게 아니야. 속을 보려면 다른 상대가 필요해." },
                intro: "네 심장을 꺼내보면 알 수 있을까? 네가 날 사랑하는지.",
                correct: "검정 교배. 넌 날 위해서라면 죽을 수도 있구나? ❤️",
                wrong: "거짓말쟁이. 혀를 잘라버릴 거야."
            },
            {
                category: "10단원: 예외 유전",
                question: "ABO식 혈액형처럼 대립유전자가 3개 이상인 유전.",
                answers: ["복대립 유전", "복대립"],
                options: ["복대립 유전", "다인자 유전", "중간 유전", "반성 유전"],
                wrong_context: { "다인자": "다인자는 자리가 여러 개인 거고, 이건 후보가 많은 거야." },
                intro: "나야, 마키마야, 아니면 파워야? 여자가 너무 많잖아.",
                correct: "복대립 유전. 하지만 선택은 하나야. 나를 골라.",
                wrong: "핑계 대지 마. 선택은 단순해."
            },
            {
                category: "10단원: 예외 유전",
                question: "분꽃의 붉은색과 흰색이 섞여 분홍색이 나오는 현상.",
                answers: ["불완전 우성", "중간 유전"],
                options: ["불완전 우성", "공동 우성", "완전 우성", "열성"],
                wrong_context: { "공동": "공동 우성은 얼룩무늬처럼 따로 나오는 거야." },
                intro: "확실하게 해. 섞이는 건 싫어. (사실은 좋아하지만)",
                correct: "불완전 우성. 그래, 가끔은 섞이는 것도 나쁘지 않지.",
                wrong: "섞이는 거랑 따로 나오는 건 다르다고."
            },
            {
                category: "10단원: 연관 유전",
                question: "두 유전자가 같은 염색체에 있어 같이 이동하는 현상.",
                answers: ["연관", "linkage"],
                options: ["연관", "교차", "독립", "분리"],
                wrong_context: { "교차": "교차는 연관을 끊을 수 있는 행위고." },
                intro: "내가 지옥에 가면 너도 따라올 거지?",
                correct: "연관. 맞아. 묶여있으니까. 넌 내 짐이야.",
                wrong: "독립은 따로 노는 거고. 우린 하나라니까?"
            },
            {
                category: "10단원: 멘델 유전",
                question: "서로 다른 형질을 결정하는 유전자는 독립적으로 유전된다는 법칙.",
                answers: ["독립의 법칙"],
                options: ["독립의 법칙", "분리의 법칙", "우열의 원리", "연관 법칙"],
                wrong_context: { "분리": "분리의 법칙은 한 형질 안에서 일어나는 거야." },
                intro: "난 누구에게도 얽매이지 않아. 자유롭고 싶어.",
                correct: "독립의 법칙. 하지만 넌 나한테 얽매여야 해.",
                wrong: "헷갈리지 마. 이건 다른 형질 얘기야."
            },

            // --- 12단원 (7문제) ---
            {
                category: "12단원: 하디-바인베르크",
                question: "유전자 빈도가 변하지 않으려면 교배가 '이것'이어야 해.",
                answers: ["무작위", "무작위 교배", "random"],
                options: ["무작위", "선택적", "인위적", "동계"],
                wrong_context: {},
                intro: "우리가 만난 건 운명 따위가 아니야. 그냥 우연이지.",
                correct: "무작위. 맞아. 계산된 사랑은 역겨워. 본능에 맡겨.",
                wrong: "의도적인 건 재미없어."
            },
            {
                category: "12단원: 소진화",
                question: "소수가 이주하여 새 집단을 만들 때 유전자 빈도가 급변하는 현상.",
                answers: ["창시자 효과", "founder effect"],
                options: ["창시자 효과", "병목 효과", "자연 선택", "돌연변이"],
                wrong_context: { "병목": "병목 효과는 재난으로 죽고 남은 거고." },
                intro: "도망치자. 아무도 없는 곳으로 가서 우리 둘만의 나라를 만드는 거야.",
                correct: "창시자 효과. 우리가 그곳의 아담과 이브가 되는 거지.",
                wrong: "헷갈리지 마. 이건 이민 가는 거야."
            },
            {
                category: "12단원: 소진화",
                question: "재해로 집단 크기가 급격히 줄어 유전자 빈도가 변하는 현상.",
                answers: ["병목 효과", "bottleneck"],
                options: ["병목 효과", "창시자 효과", "유전자 흐름", "돌연변이"],
                wrong_context: { "창시자": "창시자 효과랑 반대야. 이건 재난이라고." },
                intro: "다 죽어버리고 우리 둘만 남는다면... 그건 축복일까 저주일까?",
                correct: "병목 효과. 살아남은 게 기적이지.",
                wrong: "다시 생각해봐. 재난이야."
            },
            {
                category: "12단원: 자연선택",
                question: "한쪽 극단적인 형질이 유리해서 그쪽으로 진화하는 유형.",
                answers: ["방향성 선택", "directional"],
                options: ["방향성 선택", "안정화 선택", "분단성 선택", "성 선택"],
                wrong_context: { "안정화": "안정화는 중간만 남는 거고. 이건 한쪽으로 쏠리는 거야." },
                intro: "난 멈추는 법을 몰라. 끝까지 갈 거야. 파멸할 때까지.",
                correct: "방향성 선택. 그래프가 한쪽으로 쏠리지.",
                wrong: "안정적인 건 재미없어. 극단적으로 가자."
            },
            {
                category: "12단원: 자연선택",
                question: "양 극단 형질이 유리하고 중간이 도태되는 선택.",
                answers: ["분단성 선택", "disruptive"],
                options: ["분단성 선택", "안정화 선택", "방향성 선택", "성 선택"],
                wrong_context: { "안정화": "안정화 선택의 정반대야." },
                intro: "너와 나처럼... 극과 극인 존재들만 살아남는 세상.",
                correct: "분단성 선택. 결국 둘로 찢어지겠지.",
                wrong: "어중간한 건 죽는 거야."
            },
            {
                category: "12단원: 소진화",
                question: "집단 간에 개체가 이동하여 유전자 빈도가 변하는 현상. 이주.",
                answers: ["유전자 흐름", "gene flow"],
                options: ["유전자 흐름", "유전적 부동", "자연 선택", "돌연변이"],
                wrong_context: { "부동": "부동은 우연한 변화야. 이건 이동하는 거고." },
                intro: "내가 너에게 흘러들어가면... 넌 변하게 될까?",
                correct: "유전자 흐름. 섞이면 차이가 줄어들어.",
                wrong: "흐름(Flow)이라고. 물처럼."
            },

            // --- 13단원 (7문제) ---
            {
                category: "13단원: 비교해부학",
                question: "새의 날개와 곤충의 날개. 기원은 다르지만 겉모습만 비슷한 가짜들.",
                answers: ["상사 기관", "상사기관"],
                options: ["상사 기관", "상동 기관", "흔적 기관", "유사 기관"],
                wrong_context: { "상동": "상동 기관은 핏줄이 같은 거야. 이건 남남이라고." },
                intro: "마키마 씨가 좋아, 내가 좋아? 겉모습만 보지 말고.",
                correct: "상사 기관. 겉모습만 닮은 가짜는 필요 없어.",
                wrong: "틀렸어. 난 그 여자랑 달라."
            },
            {
                category: "13단원: 비교해부학",
                question: "사람 팔과 고래 앞지느러미. 겉모습은 달라도 뼈대(기원)는 같은 기관.",
                answers: ["상동 기관", "상동기관"],
                options: ["상동 기관", "상사 기관", "흔적 기관", "유사 기관"],
                wrong_context: { "상사": "상사 기관이랑 반대야. 겉만 보지 말고 속을 봐." },
                intro: "우린 겉모습은 달라도... 속은 똑같이 망가져 있어.",
                correct: "상동 기관. 맞아. 우린 통하는 게 있어.",
                wrong: "다시 생각해봐. 뿌리는 같아."
            },
            {
                category: "13단원: 흔적 기관",
                question: "과거엔 기능이 있었으나 퇴화해 흔적만 남은 기관.",
                answers: ["흔적 기관", "흔적기관"],
                options: ["흔적 기관", "상동 기관", "상사 기관", "유사 기관"],
                wrong_context: { "상동": "상동 기관은 기능이 있잖아." },
                intro: "내 마음에도... 인간이었던 시절의 감정이 남아있을까?",
                correct: "흔적 기관. 꼬리뼈처럼... 아프기만 한 존재.",
                wrong: "쓸모없어진 게 포인트야."
            },
            {
                category: "13단원: 분자생물학",
                question: "모든 생물이 같은 유전 암호(코돈)를 쓴다는 건, 우리가 하나의 '이것'에서 나왔다는 증거.",
                answers: ["공통 조상", "common ancestor"],
                options: ["공통 조상", "수렴 진화", "자연 선택", "이소적 종분화"],
                wrong_context: {},
                intro: "너랑 나, 그리고 저 벌레도... 아주 먼 옛날엔 가족이었을지도 몰라.",
                correct: "공통 조상. 모든 건 하나로 연결돼 있어.",
                wrong: "뿌리를 묻는 거야."
            },
            {
                category: "13단원: 화석상 증거",
                question: "시조새처럼 두 분류군(파충류-조류)의 특징을 모두 가진 화석.",
                answers: ["전이 화석", "중간 화석"],
                options: ["전이 화석", "표준 화석", "시상 화석", "흔적 화석"],
                wrong_context: { "시상": "시상 화석은 환경을 알려주는 거고." },
                intro: "난 인간일까 악마일까? 그 중간 어디쯤일까?",
                correct: "전이 화석. 연결 고리 같은 거지.",
                wrong: "다리 역할을 하는 화석 말이야."
            },
            
            // --- 14단원 (9문제) ---
            {
                category: "14단원: 종분화",
                question: "지리적 장벽에 의해 멀리 떨어져서 일어나는 종분화.",
                answers: ["이소적 종분화", "allopatric"],
                options: ["이소적 종분화", "동소적 종분화", "점진적 종분화", "단속 평형"],
                wrong_context: { "동소적": "동소적은 같이 사는 거고. 이건 멀리 떨어져서." },
                intro: "내가 러시아로 돌아가면... 넌 날 잊을 거지?",
                correct: "이소적 종분화. 하지만 넌 예외야. 끝까지 쫓아갈 거니까.",
                wrong: "틀렸어. 넌 내 거라는 걸 잊지 마."
            },
            {
                category: "14단원: 생식적 장벽",
                question: "생식기 구조가 맞지 않아 교배할 수 없는 격리.",
                answers: ["기계적 격리", "mechanical"],
                options: ["기계적 격리", "행동적 격리", "시간적 격리", "배우자 격리"],
                wrong_context: { "행동적": "행동적 격리는 춤추는 거고. 이건 물리적인 문제야." },
                intro: "열쇠가 자물쇠에 안 맞으면 어떻게 할 거야? 부숴버릴 거야?",
                correct: "기계적 격리. 몸의 대화가 안 통하면... 죽을 때까지 싸우자.",
                wrong: "다시 생각해봐. 물리적인 이유야."
            },
            {
                category: "14단원: 종분화",
                question: "같은 장소에 살지만 생식적으로 격리되어 분화하는 현상.",
                answers: ["동소적 종분화", "sympatric"],
                options: ["동소적 종분화", "이소적 종분화", "지리적 격리", "창시자 효과"],
                wrong_context: { "이소적": "이소적은 멀리 떨어진 거야. 넌 내 옆에 있잖아." },
                intro: "이렇게 가까이 있는데... 왜 넌 날 안 봐?",
                correct: "동소적 종분화. 가까워도 먼 사이. 슬프네.",
                wrong: "같은 장소라고 했잖아."
            },
            {
                category: "14단원: 멸종",
                question: "대멸종 이후 살아남은 종이 빈자리를 차지하며 급격히 다양해지는 현상.",
                answers: ["적응 방산", "adaptive radiation"],
                options: ["적응 방산", "대멸종", "수렴 진화", "공진화"],
                wrong_context: { "수렴": "수렴은 모이는 거고, 이건 퍼지는 거야." },
                intro: "다 죽여버리고 나면... 세상은 우리 차지가 될 거야.",
                correct: "적응 방산. 위기는 기회야. 내 손을 잡아.",
                wrong: "방산(Radiation)처럼 퍼져나가는 거야."
            },
            {
                category: "14단원: 종의 개념",
                question: "생물학적 종의 정의. 자연 상태에서 교배하여 '이것' 있는 자손을 낳아야 한다.",
                answers: ["생식 능력", "생식능력"],
                options: ["생식 능력", "생존 능력", "적응력", "변이"],
                wrong_context: { "생존": "살아만 있다고 다가 아니야." },
                intro: "사랑의 결실이... 또 다른 사랑을 낳을 수 있어야 진짜야.",
                correct: "생식 능력. 불임이면 종이 아니야. 슬프지만.",
                wrong: "다시 생각해. 후손을 남길 수 있느냐는 거야."
            },
            {
                category: "14단원: 생식적 장벽",
                question: "구애 행동이나 신호가 달라서 짝짓기가 안 되는 격리.",
                answers: ["행동적 격리", "behavioral"],
                options: ["행동적 격리", "시간적 격리", "기계적 격리", "배우자 격리"],
                wrong_context: { "시간적": "시간적 격리는 밤낮이 다른 거고." },
                intro: "내가 윙크를 했는데 네가 못 알아먹으면... 죽여버릴 거야.",
                correct: "행동적 격리. 신호가 안 맞으면 남남이지.",
                wrong: "행동! Action! 알겠어?"
            },
            {
                category: "14단원: 생식적 장벽",
                question: "잡종 1대는 정상인데 2대부터 약하거나 불임이 되는 현상.",
                answers: ["잡종 붕괴", "hybrid breakdown"],
                options: ["잡종 붕괴", "잡종 불임", "잡종 생존력 저하", "배우자 격리"],
                wrong_context: { "불임": "잡종 불임은 1대부터 불임인 거야." },
                intro: "처음엔 괜찮은 줄 알았는데... 갈수록 망가져가는 관계.",
                correct: "잡종 붕괴. 결국은 파국이네.",
                wrong: "붕괴(Breakdown)라는 단어를 기억해."
            }
        ];

        // 2. 사담 데이터... (생략, 이전 코드와 동일)
        const chatEpisodes = [
            {
                text: "그나저나 덴지 군, 시골 쥐랑 도시 쥐 이야기 알아? <br>넌 어느 쪽이 좋아?",
                options: ["시골 쥐", "도시 쥐", "너랑 함께라면 어디든"],
                replies: {
                    "시골 쥐": "흐음... 평온한 삶을 원해?",
                    "도시 쥐": "맛있는 걸 먹지만 언제 죽을지 모르는 삶... 그렇구나..",
                    "너랑 함께라면 어디든": "아하하! 정답이야. 덴지 군은 가끔 귀여운 소리를 한다니까."
                }
            },
            {
                text: "마키마 씨 말이야... 냄새가 나. <br>아주 나쁜 '개' 냄새가 난다고 생각하지 않아?",
                options: ["마키마 씨는 좋아", "난 코가 막혀서", "네 냄새가 더 좋아"],
                replies: {
                    "마키마 씨는 좋아": "칫. 재미없어. 그 여자한테 먹혀버려라.",
                    "난 코가 막혀서": "바보. 언제쯤 눈치챌래? 조심하는 게 좋을 거야.",
                    "네 냄새가 더 좋아": "어라? 대담하네. 내 냄새는 화약 냄새일 텐데? 후후."
                }
            },
            {
                text: "학교 축제 가본 적 있어? <br>난 학교에 다녀본 적이 없어서... 좀 궁금해.",
                options: ["나도 안 가봤어", "다음에 같이 가자", "별거 없어"],
                replies: {
                    "나도 안 가봤어": "우린 참 닮은 점이 많네. 그래서 네가 좋아.",
                    "다음에 같이 가자": "약속했다? 사과 사탕도 사주고, 불꽃놀이도 보여줘야 해.",
                    "별거 없어": "덴지 군이랑 가면 다를지도 모르잖아. 시시하긴."
                }
            },
            {
                text: "저기, 덴지 군. 영화 좋아해? <br>난 다 죽어버리는 영화가 좋더라.",
                options: ["나도 좋아해", "난 해피엔딩이 좋아", "액션 영화가 좋아"],
                replies: {
                    "나도 좋아해": "역시! 파멸적인 결말이 아름답지. 우리처럼.",
                    "난 해피엔딩이 좋아": "해피엔딩이라... 꿈같은 소리네. 뭐, 노력은 해볼게.",
                    "액션 영화가 좋아": "그럼 내가 폭발하는 거 보여줄까? 최고의 액션일걸?"
                }
            },
            {
                text: "카페 일 끝나고 같이 도망칠까? <br>아무도 우릴 모르는 곳으로.",
                options: ["어디로?", "일은 어쩌고?", "좋아"],
                replies: {
                    "어디로?": "어디든. 바다가 보이는 곳이면 좋겠어. 수영도 하고.",
                    "일은 어쩌고?": "바보. 일이 중요해, 내가 중요해? 그냥 다 터뜨리고 가자.",
                    "좋아": "준비해 둬. 오늘 밤에 데리러 갈 테니까."
                }
            }
        ];


        let queue = [];
        let currentQ = null;
        let wrongAttempts = 0;
        let totalWrong = 0;
        let isChatting = false;

        function startGame() {
            queue = JSON.parse(JSON.stringify(questionBank));
            queue.sort(() => Math.random() - 0.5);
            
            document.getElementById('start-screen').classList.add('hidden');
            setTimeout(() => {
                addMessage('reze', "좋아. 그럼 시작하자. 딴짓하면 죽어?");
                setTimeout(() => nextStep(), 1000);
            }, 500);
        }

        function showTyping() {
            const typing = document.getElementById('typing');
            const chatBox = document.getElementById('chat-box');
            chatBox.appendChild(typing);
            typing.style.display = 'block';
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function hideTyping() {
            document.getElementById('typing').style.display = 'none';
        }

        function addMessage(type, text, isHTML = false) {
            const chatBox = document.getElementById('chat-box');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${type}`;

            let innerContent = '';
            if (type === 'reze') {
                innerContent += `<img src="images-2.jpeg" class="profile-pic-chat">`;
            }
            
            innerContent += `<div class="bubble">${text}</div>`;
            
            msgDiv.innerHTML = innerContent;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function nextStep() {
            if (queue.length === 0) {
                showEnding();
                return;
            }

            if (!isChatting && Math.random() < 0.2 && queue.length < questionBank.length - 1) {
                triggerSmallTalk();
            } else {
                nextQuestion();
            }
        }

        function triggerSmallTalk() {
            isChatting = true;
            const episode = chatEpisodes[Math.floor(Math.random() * chatEpisodes.length)];
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', episode.text);
                
                setTimeout(() => {
                    const chatBox = document.getElementById('chat-box');
                    const wrapper = document.createElement('div');
                    wrapper.className = 'options-container';
                    
                    let buttonsHTML = "";
                    episode.options.forEach(opt => {
                        buttonsHTML += `<button class="option-btn" onclick="handleChatReply(this, '${episode.replies[opt]}', '${opt}')">${opt}</button>`;
                    });
                    
                    wrapper.innerHTML = buttonsHTML;
                    chatBox.appendChild(wrapper);
                    chatBox.scrollTop = chatBox.scrollHeight;
                    enableInput(false);
                }, 500);
            }, 1000);
        }

        window.handleChatReply = function(btn, replyText, userText) {
            const container = btn.parentElement;
            const buttons = container.querySelectorAll('.option-btn');
            buttons.forEach(b => {
                b.disabled = true;
                b.style.opacity = '0.5';
            });
            btn.style.backgroundColor = 'var(--accent-color)';
            btn.style.color = 'black';
            btn.style.opacity = '1';

            addMessage('user', userText);
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', replyText);
                isChatting = false;
                setTimeout(() => nextStep(), 1500);
            }, 1000);
        };

        function nextQuestion() {
            if (queue.length === 0) {
                showEnding();
                return;
            }

            currentQ = queue.shift();
            wrongAttempts = 0;
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', currentQ.intro);
                
                setTimeout(() => {
                    const questionHTML = `
                        <div class="question-card">
                            <span class="question-tag">QUESTION ${questionBank.length - queue.length}</span>
                            <div class="question-text">[${currentQ.category}]<br>${currentQ.question}</div>
                        </div>
                    `;
                    addMessage('reze', questionHTML, true);
                    enableInput(true);
                }, 800);
            }, 1000);
        }

        function checkAnswer(optionValue = null) {
            const inputEl = document.getElementById('answer-input');
            const val = optionValue || inputEl.value.trim();
            
            if (!val) return;

            addMessage('user', val);
            inputEl.value = "";
            enableInput(false);

            const cleanVal = val.toLowerCase().replace(/s/g, '');
            const isCorrect = currentQ.answers.some(ans => ans.toLowerCase().replace(/s/g, '') === cleanVal);

            showTyping();

            setTimeout(() => {
                hideTyping();
                if (isCorrect) {
                    addMessage('reze', currentQ.correct);
                    setTimeout(() => nextStep(), 1000);
                } else {
                    handleWrongAnswer(cleanVal);
                }
            }, 800);
        }

        function handleWrongAnswer(userAnswer) {
            wrongAttempts++;
            totalWrong++;
            
            // 맥락에 맞는 오답 처리
            let specificWrongMsg = currentQ.wrong; // 기본 오답 메시지
            if (currentQ.wrong_context) {
                for (const key in currentQ.wrong_context) {
                    if (userAnswer.includes(key)) {
                        specificWrongMsg = currentQ.wrong_context[key];
                        break;
                    }
                }
            }
            
            addMessage('reze', specificWrongMsg);

            if (wrongAttempts >= 2) {
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        addMessage('reze', "하아... 힌트 줄게. 골라봐.");
                        showOptions();
                    }, 800);
                }, 500);
            } else {
                enableInput(true);
            }
        }

        function showOptions() {
            const shuffledOptions = [...currentQ.options].sort(() => Math.random() - 0.5);
            let buttonsHTML = "";
            shuffledOptions.forEach(opt => {
                buttonsHTML += `<button class="option-btn" onclick="selectQuizOption('${opt}', this)">${opt}</button>`;
            });
            
            const chatBox = document.getElementById('chat-box');
            const wrapper = document.createElement('div');
            wrapper.className = 'options-container';
            wrapper.innerHTML = buttonsHTML;
            
            chatBox.appendChild(wrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        window.selectQuizOption = function(val, btnElement) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => {
                b.disabled = true;
                b.style.opacity = '0.5';
            });
            btnElement.style.backgroundColor = 'var(--accent-color)';
            btnElement.style.color = 'black';
            btnElement.style.opacity = '1';
            
            checkAnswer(val);
        };

        function enableInput(enable) {
            const input = document.getElementById('answer-input');
            const btn = document.getElementById('send-btn');
            input.disabled = !enable;
            btn.disabled = !enable;
            if(enable) input.focus();
        }

        function showEnding() {
            let finalMsg = "";
            if (totalWrong === 0) {
                finalMsg = "거짓말... 완벽해. <br>좋아. 오늘 밤은 네가 하고 싶은 대로 해. 🔥";
            } else if (totalWrong <= 10) {
                finalMsg = `끝났네. ${totalWrong}번 실수했지만...<br>귀여우니까 봐줄게. 카페에서 기다릴게.`;
            } else {
                finalMsg = "펑! 💣<br>도시 쥐는 역시 안 되네. <br>잘 가.";
            }
            
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('reze', finalMsg);
                document.getElementById('answer-input').placeholder = "대화가 종료되었습니다.";
            }, 1500);
        }
    </script>
</body>
</html>
